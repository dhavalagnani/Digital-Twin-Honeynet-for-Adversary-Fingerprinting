# Digital Twin Honeynet - Auditd Rules
# Comprehensive privilege escalation and security event logging

# Monitor all execve syscalls
-a always,exit -F arch=b64 -S execve -k execve_audit
-a always,exit -F arch=b32 -S execve -k execve_audit

# Monitor sudo usage
-w /usr/bin/sudo -p wa -k sudo_usage
-w /etc/sudoers -p wa -k sudo_config
-w /etc/sudoers.d/ -p wa -k sudo_config

# Monitor su usage
-w /bin/su -p wa -k su_usage
-w /usr/bin/su -p wa -k su_usage

# Monitor passwd changes
-w /usr/bin/passwd -p wa -k passwd_changes
-w /etc/passwd -p wa -k passwd_file
-w /etc/shadow -p wa -k shadow_file

# Monitor root access
-w /bin/su -p x -k root_access
-w /usr/bin/sudo -p x -k root_access

# Monitor SSH key changes
-w /home/*/.ssh/ -p wa -k ssh_keys
-w /root/.ssh/ -p wa -k ssh_keys

# Monitor system configuration changes
-w /etc/hosts -p wa -k system_config
-w /etc/resolv.conf -p wa -k system_config
-w /etc/fstab -p wa -k system_config

# Monitor user management
-w /usr/sbin/useradd -p wa -k user_management
-w /usr/sbin/userdel -p wa -k user_management
-w /usr/sbin/usermod -p wa -k user_management

# Monitor file permission changes
-a always,exit -F arch=b64 -S chmod -k file_permissions
-a always,exit -F arch=b32 -S chmod -k file_permissions
-a always,exit -F arch=b64 -S chown -k file_permissions
-a always,exit -F arch=b32 -S chown -k file_permissions

# Monitor network configuration
-w /etc/network/ -p wa -k network_config
-w /etc/netplan/ -p wa -k network_config

# Monitor firewall changes
-w /etc/ufw/ -p wa -k firewall_config
-w /etc/nftables.conf -p wa -k firewall_config

# Monitor service management
-w /usr/bin/systemctl -p wa -k service_management
-w /etc/systemd/ -p wa -k service_management

# Monitor cron jobs
-w /etc/crontab -p wa -k cron_changes
-w /var/spool/cron/ -p wa -k cron_changes

# Monitor package management
-w /usr/bin/apt -p wa -k package_management
-w /usr/bin/dpkg -p wa -k package_management

# Monitor login/logout events
-w /var/log/wtmp -p wa -k login_events
-w /var/log/btmp -p wa -k login_events
-w /var/log/lastlog -p wa -k login_events

# Monitor kernel module loading
-w /sbin/insmod -p x -k kernel_modules
-w /sbin/rmmod -p x -k kernel_modules
-w /sbin/modprobe -p x -k kernel_modules

# Monitor mount/unmount operations
-a always,exit -F arch=b64 -S mount -k mount_operations
-a always,exit -F arch=b32 -S mount -k mount_operations
-a always,exit -F arch=b64 -S umount2 -k mount_operations
-a always,exit -F arch=b32 -S umount2 -k mount_operations

# Monitor process creation
-a always,exit -F arch=b64 -S clone -k process_creation
-a always,exit -F arch=b32 -S clone -k process_creation
-a always,exit -F arch=b64 -S fork -k process_creation
-a always,exit -F arch=b32 -S fork -k process_creation

# Monitor file access patterns
-a always,exit -F arch=b64 -S open -k file_access
-a always,exit -F arch=b32 -S open -k file_access
-a always,exit -F arch=b64 -S openat -k file_access
-a always,exit -F arch=b32 -S openat -k file_access

# Monitor network connections
-a always,exit -F arch=b64 -S connect -k network_connections
-a always,exit -F arch=b32 -S connect -k network_connections
-a always,exit -F arch=b64 -S accept -k network_connections
-a always,exit -F arch=b32 -S accept -k network_connections

# Monitor privilege escalation attempts
-a always,exit -F arch=b64 -S setuid -k privilege_escalation
-a always,exit -F arch=b32 -S setuid -k privilege_escalation
-a always,exit -F arch=b64 -S setgid -k privilege_escalation
-a always,exit -F arch=b32 -S setgid -k privilege_escalation
